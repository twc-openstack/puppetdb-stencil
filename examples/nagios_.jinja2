{% set allowed_metaparams = ('alias',) %}
{% set named_objects = ('host', 'hostgroup', 'servicegroup', 'contact', 'contactgroup', 'timeperiod', 'command') %}
{% set object_name = resource_type[7:] %}
{% set named_object = object_name in named_objects %}
{% for resource in resources %}
{% set envs_to_ignore = [] %}
{% if resource.exported %}
{% if "only-cross-site" not in resource.tags or localsite == "false" %}
define {{ object_name }} {
    {% if named_object %}
    {{ object_name }}_name {{ resource.name }}
    {% endif %}
    {% for key, value in resource.parameters.items() %}
    {% if key not in metaparams or key in allowed_metaparams %}
    {% if value is iterable and value is not string %}
    {{ key }} {{ value|join(", ") }}
    {% else %}
    {{ key }} {{ value }}
    {% set _ = envs_to_ignore.append((object_name ~ '_' ~ key)|upper) %}
    {% endif %}
    {% endif %}
    {% endfor %}
    {% for name in env %}
    {% set nameparts = name.split('_') %}
    {% if nameparts[0]|lower == object_name %}
    {% if name not in envs_to_ignore %}
    {{ ("_".join(nameparts[1:]))|lower }} {{ env[name]|lower }}
    {% endif %}
    {% endif %}
    {% endfor %}
}
{% endif %}
{% endif %}
{% endfor %}
